app=/home/shikhar/chopped_sym/build_prechop/bin/klee
args="--libc=uclibc --posix-runtime --timeOut=1800 --no-output --inline=strlen,strcat,strncat \
  --skip-functions=__bb0,__bb1,_asn1_str_cat:403/404,asn1_delete_structure \
  --lb -max-memory=4096 -split-search -split-ratio=20 -o=tt  --exit-on-error-type=Ptr"
target="test.bc 15"

declare -a searches=("DFS" "BFS" "RAND");
declare -a cores=("2" "4" "6" "8" "10");
declare -a singleCore=("1");
declare -a bugs=("574");

for ((idx1=0; idx1<${#singleCore[@]}; ++idx1)); do
  for ((idx2=0; idx2<${#bugs[@]}; ++idx2)); do
    for ((idx3=0; idx3<${#searches[@]}; ++idx3)); do
      core=${singleCore[idx1]}
      bug=${bugs[idx2]}
      search=${searches[idx3]}
  
      echo "mpirun -n $(($core+2)) $app $args --output-dir=$search"_"$core"_"$bug --phase1Depth=0 --phase2Depth=0 \
        --error-location=parser_aux.c:$bug  --searchPolicy=$search $target &> log_$search"_"$core"_"$bug"
      mpirun -n $(($core+2)) $app $args --output-dir=$search"_"$core"_"$bug --phase1Depth=0 --phase2Depth=0 \
        --error-location=parser_aux.c:$bug  --searchPolicy=$search $target &> log_$search"_"$core"_"$bug
      rm -rf $search"_"$core"_"$bug*
      rm -rf tt*
    done
  done
done

for ((idx1=0; idx1<${#cores[@]}; ++idx1)); do
  for ((idx2=0; idx2<${#bugs[@]}; ++idx2)); do
    for ((idx3=0; idx3<${#searches[@]}; ++idx3)); do
      core=${cores[idx1]}
      bug=${bugs[idx2]}
      search=${searches[idx3]}
  
      echo "mpirun -n $(($core+2)) $app $args --output-dir=$search"_"$core"_"$bug --phase1Depth=$core --phase2Depth=0 \
        --error-location=parser_aux.c:$bug  --searchPolicy=$search $target"
      mpirun -n $(($core+2)) $app $args --output-dir=$search"_"$core"_"$bug --phase1Depth=$core --phase2Depth=0 \
        --error-location=parser_aux.c:$bug  --searchPolicy=$search $target &> log_$search"_"$core"_"$bug
      rm -rf $search"_"$core"_"$bug*
      rm -rf tt*
   done
  done
done
